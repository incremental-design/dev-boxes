---
- hosts: raspberrypi

  tasks:
    - name: Expand root filesystem.
      shell: >
        raspi-config --expand-rootfs
      args:
        executable: /bin/bash

    - name: reboot the pi.
      reboot:
        reboot_timeout: 600

    - name: Update DHCP servers.
      shell: >
        echo "static domain_name_servers=1.1.1.1 1.0.0.1" >> /etc/dhcpcd.conf && service dhcpcd restart && sleep 5
      args:
        executable: /bin/bash

    - name: Update package list (This could take 10+ minutes).
      shell: >
        apt-get update
      args:
        warn: false

    - name: Install tshark, tmux, mosh, nmap, iperf3, htop
      shell: >
        export DEBIAN_FRONTEND=noninteractive && apt-get install -qq -y tshark tmux mosh nmap iperf3 htop
      args:
        warn: false

    - name: Shut down pi.
      community.general.shutdown:
